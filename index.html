<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 Neon Runner - Ultra Addictive Production | LIPA Studios</title>
    <meta name="description" content="Play Neon Runner, the addictive endless cyberpunk runner! Dodge obstacles, collect coins, beat high scores. Free HTML5 game by LIPA Studios.">
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-633RQLC6T0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-633RQLC6T0');
        
        window.trackEvent = function(eventName, parameters = {}) {
            gtag('event', eventName, {
                event_category: 'game_interaction',
                ...parameters
            });
        };
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4837743291717475"
            crossorigin="anonymous"></script>
    
    <!-- H5 Games Ads API -->
    <script>
        window.adBreak = function(config) {
            console.log('AdBreak called:', config);
            // Simulate ad experience for testing
            if (config.beforeAd) config.beforeAd();
            setTimeout(() => {
                if (config.afterAd) config.afterAd();
            }, config.type === 'reward' ? 3000 : 1500);
        };
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #050505 0%, #0a0a0a 50%, #1a0a1a 100%);
            color: #00FFFF;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            user-select: none;
            /* Performance optimizations */
            will-change: auto;
            transform: translateZ(0);
        }
        
        .title {
            font-size: 4rem;
            font-weight: 900;
            color: #FF0080;
            text-shadow: 0 0 30px #FF0080;
            margin-bottom: 20px;
            letter-spacing: 0.1em;
            animation: titlePulse 2s ease-in-out infinite;
        }
        
        @keyframes titlePulse {
            0%, 100% { text-shadow: 0 0 30px #FF0080; }
            50% { text-shadow: 0 0 50px #FF0080, 0 0 70px #FF0080; }
        }
        
        .subtitle {
            font-size: 2rem;
            font-weight: 700;
            color: #00FFFF;
            text-shadow: 0 0 20px #00FFFF;
            margin-bottom: 40px;
            letter-spacing: 0.2em;
        }
        
        .btn {
            padding: 20px 40px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #FF0080;
            border-radius: 12px;
            color: #FF0080;
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin: 10px;
        }
        
        .btn:hover {
            background: rgba(255, 0, 128, 0.1);
            box-shadow: 0 0 25px rgba(255, 0, 128, 0.5);
            transform: translateY(-3px);
        }
        
        .game-area {
            width: 100vw;
            height: 60vh;
            border: 2px solid #00FFFF;
            border-radius: 10px;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 50%, #0a1a1a 100%);
            position: fixed;
            top: 140px;
            left: 50%;
            transform: translateX(-50%);
            margin: 0;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            /* Performance optimizations */
            will-change: transform;
            contain: layout style paint;
            z-index: 10;
            /* HORIZONTAL GAMEPLAY EN PANTALLA VERTICAL */
            max-width: 95vw;
        }
        
        .runner {
            position: absolute;
            left: 80px;
            bottom: 20px;
            width: 40px;
            height: 60px;
            background: linear-gradient(45deg, #FF0080, #00FFFF);
            border-radius: 8px;
            box-shadow: 0 0 20px #FF0080;
            transition: all 0.3s ease;
            /* Performance optimizations */
            will-change: transform, box-shadow;
            transform: translateZ(0);
            z-index: 20;
            /* HORIZONTAL RUNNER OPTIMIZADO PARA VERTICAL */
            border: 2px solid #FFFFFF;
        }
        
        @keyframes runnerPulse {
            0%, 100% { 
                box-shadow: 0 0 20px #FF0080;
                transform: translateZ(0) translateX(-50%) scale(1);
            }
            50% { 
                box-shadow: 0 0 40px #FF0080, 0 0 60px #00FFFF;
                transform: translateZ(0) translateX(-50%) scale(1.1);
            }
        }
        
        .runner.jumping {
            animation: jumpAnimation 0.6s ease-out;
        }
        
        .runner.double-jump {
            animation: doubleJumpAnimation 0.8s ease-out;
        }
        
        .runner.triple-jump {
            animation: tripleJumpAnimation 1s ease-out;
        }
        
        @keyframes jumpAnimation {
            0% { bottom: 50px; }
            50% { bottom: 200px; }
            100% { bottom: 50px; }
        }
        
        @keyframes doubleJumpAnimation {
            0% { bottom: 50px; transform: rotate(0deg); }
            25% { bottom: 250px; transform: rotate(90deg); }
            50% { bottom: 300px; transform: rotate(180deg); }
            75% { bottom: 250px; transform: rotate(270deg); }
            100% { bottom: 50px; transform: rotate(360deg); }
        }
        
        @keyframes tripleJumpAnimation {
            0% { bottom: 50px; transform: rotate(0deg) scale(1); box-shadow: 0 0 20px #FF0080; }
            20% { bottom: 300px; transform: rotate(120deg) scale(1.2); box-shadow: 0 0 40px #FF0080, 0 0 60px #00FFFF; }
            40% { bottom: 400px; transform: rotate(240deg) scale(1.5); box-shadow: 0 0 60px #FF0080, 0 0 80px #00FFFF, 0 0 100px #FFFF00; }
            60% { bottom: 450px; transform: rotate(360deg) scale(1.8); box-shadow: 0 0 80px #FF0080, 0 0 100px #00FFFF, 0 0 120px #FFFF00; }
            80% { bottom: 300px; transform: rotate(480deg) scale(1.2); box-shadow: 0 0 40px #FF0080, 0 0 60px #00FFFF; }
            100% { bottom: 50px; transform: rotate(720deg) scale(1); box-shadow: 0 0 20px #FF0080; }
        }
        
        .obstacle {
            position: absolute;
            width: 30px;
            height: 50px;
            background: linear-gradient(45deg, #FF0000, #8B0000);
            border: 2px solid #FFFFFF;
            border-radius: 5px;
            bottom: 20px;
            right: 0px;
            box-shadow: 0 0 25px #FF0000, inset 0 0 10px rgba(255,255,255,0.3);
            animation: dangerPulse 0.8s ease-in-out infinite;
            z-index: 15;
            /* HORIZONTAL OBSTACLE - OPTIMIZADO PARA PANTALLA VERTICAL */
        }
        
        @keyframes dangerPulse {
            0%, 100% { 
                box-shadow: 0 0 25px #FF0000, inset 0 0 10px rgba(255,255,255,0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px #FF0000, 0 0 60px #FF0000, inset 0 0 15px rgba(255,255,255,0.5);
                transform: scale(1.05);
            }
        }
        
        .coin {
            position: absolute;
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, #FFFF00, #FFD700);
            border-radius: 50%;
            bottom: 40px;
            right: 0px;
            box-shadow: 0 0 15px #FFFF00;
            animation: coinSpin 1s linear infinite, coinGlow 2s ease-in-out infinite;
            z-index: 15;
            /* HORIZONTAL COIN - OPTIMIZADO PARA PANTALLA VERTICAL */
        }
        
        @keyframes coinSpin {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }
        
        @keyframes coinGlow {
            0%, 100% { box-shadow: 0 0 20px #FFFF00; }
            50% { box-shadow: 0 0 40px #FFFF00, 0 0 60px #FFD700; }
        }
        
        /* EFECTOS ULTRA-ADICTIVOS */
        .runner.speed-boost {
            box-shadow: 0 0 30px #FFFF00, 0 0 50px #FFFF00;
            animation: speedBoostGlow 0.2s ease-in-out infinite;
        }
        
        @keyframes speedBoostGlow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .perfect-indicator {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #39FF14, #00FF00);
            color: #000;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: 900;
            z-index: 9999;
            pointer-events: none;
            animation: perfectPop 1s ease-out forwards;
            text-shadow: 0 0 10px #39FF14;
            box-shadow: 0 0 30px #39FF14;
        }
        
        @keyframes perfectPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0) rotate(-10deg); }
            30% { opacity: 1; transform: translate(-50%, -50%) scale(1.3) rotate(5deg); }
            70% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) rotate(0deg); }
        }
        
        .streak-counter {
            position: fixed;
            top: 20%;
            right: 20px;
            background: linear-gradient(45deg, #FF0080, #FF0040);
            color: #FFF;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 900;
            font-size: 1.2rem;
            z-index: 9999;
            animation: streakPulse 0.5s ease-in-out;
            box-shadow: 0 0 20px #FF0080;
        }
        
        @keyframes streakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .combo-explosion {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: 900;
            color: #FFFF00;
            text-shadow: 0 0 20px #FFFF00;
            z-index: 9999;
            pointer-events: none;
            animation: comboExplosion 1.2s ease-out forwards;
        }
        
        @keyframes comboExplosion {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0) rotate(-30deg); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.5) rotate(10deg); }
            40% { opacity: 1; transform: translate(-50%, -50%) scale(1.2) rotate(-5deg); }
            60% { opacity: 1; transform: translate(-50%, -50%) scale(1.3) rotate(0deg); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5) rotate(0deg); }
        }
        
        .screen-shake {
            animation: screenShake 0.3s ease-in-out;
        }
        
        @keyframes screenShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) translateY(2px); }
            75% { transform: translateX(5px) translateY(-2px); }
        }
        
        /* Partículas para efectos épicos */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FFFF00;
            border-radius: 50%;
            pointer-events: none;
            z-index: 45;
        }
        
        .particle.coin-burst {
            animation: coinBurst 0.8s ease-out forwards;
        }
        
        @keyframes coinBurst {
            0% { opacity: 1; transform: scale(1) translate(0, 0); }
            100% { opacity: 0; transform: scale(0) translate(var(--dx), var(--dy)); }
        }
        
        .trail-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 0, 0.3), transparent);
            animation: trailSweep 0.5s ease-out;
            pointer-events: none;
            z-index: 30;
        }
        
        @keyframes trailSweep {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        
        .power-up {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 4px solid #FFFFFF;
            box-shadow: 0 0 30px;
            animation: powerUpPulse 0.6s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 900;
        }
        
        .power-up.shield {
            background: radial-gradient(circle, #39FF14, #00FF00);
            box-shadow: 0 0 30px #39FF14, 0 0 50px #39FF14;
        }
        .power-up.shield::before {
            content: '🛡️';
            font-size: 1.5rem;
        }
        
        .power-up.slow-motion {
            background: radial-gradient(circle, #00FFFF, #0080FF);
            box-shadow: 0 0 30px #00FFFF, 0 0 50px #00FFFF;
        }
        .power-up.slow-motion::before {
            content: '⏰';
            font-size: 1.5rem;
        }
        
        .power-up.magnet {
            background: radial-gradient(circle, #FF0080, #FF0040);
            box-shadow: 0 0 30px #FF0080, 0 0 50px #FF0080;
        }
        .power-up.magnet::before {
            content: '🧲';
            font-size: 1.5rem;
        }
        
        .power-up.energy {
            background: radial-gradient(circle, #FFFF00, #FFD700);
            box-shadow: 0 0 30px #FFFF00, 0 0 50px #FFFF00;
        }
        .power-up.energy::before {
            content: '⚡';
            font-size: 1.5rem;
        }
        
        @keyframes powerUpPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        
        .runner.shielded {
            box-shadow: 0 0 30px #39FF14, 0 0 50px #39FF14;
            animation: shieldGlow 0.5s ease-in-out infinite;
        }
        
        @keyframes shieldGlow {
            0%, 100% { box-shadow: 0 0 30px #39FF14; }
            50% { box-shadow: 0 0 50px #39FF14, 0 0 70px #39FF14; }
        }
        
        .runner.double-jump {
            animation: doubleJumpAnimation 0.8s ease-out;
        }
        
        @keyframes doubleJumpAnimation {
            0% { bottom: 200px; }
            25% { bottom: 300px; }
            50% { bottom: 350px; }
            75% { bottom: 300px; }
            100% { bottom: 150px; }
        }
        
        .slow-motion-effect {
            animation: slowMotionBlink 0.3s ease-in-out infinite;
        }
        
        @keyframes slowMotionBlink {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(180deg); }
        }
        
        .ui {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .ui-item {
            background: rgba(16, 16, 16, 0.9);
            border: 2px solid #00FFFF;
            border-radius: 8px;
            padding: 10px 20px;
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        .ui-label {
            font-size: 0.8rem;
            opacity: 0.8;
                margin-bottom: 5px;
            }
            
        .ui-value {
            font-size: 1.5rem;
            font-weight: 900;
            color: #FFFF00;
            text-shadow: 0 0 10px #FFFF00;
        }
        
        .instructions {
            color: #39FF14;
                font-size: 1.2rem;
            text-align: center;
            margin: 20px 0;
        }
        
        .debug {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #39FF14;
            padding: 10px;
            border-radius: 5px;
                font-size: 0.8rem;
            }
            
        .hidden {
            display: none !important;
        }
        
        .screen {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, #050505 0%, #0a0a0a 50%, #1a0a1a 100%);
            z-index: 100;
                    }
        
        /* SIMPLE FLIGHT INDICATOR (MOBILE-FIRST) */
        .flight-energy-container {
            display: none; /* Hidden for mobile simplicity */
        }
        
        .flight-energy-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF0080, #00FFFF, #FFFF00);
            border-radius: 8px;
            transition: width 0.1s ease;
            box-shadow: 0 0 10px currentColor;
            animation: energyPulse 1s ease-in-out infinite;
        }
        
        .flight-energy-bar.low {
            background: linear-gradient(90deg, #FF0000, #FF4500);
            animation: energyWarning 0.3s ease-in-out infinite;
        }
        
        @keyframes energyPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        @keyframes energyWarning {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
    </style>
    <!-- FIXES QUE FUNCIONAN NEON RUNNER v2.2 -->
</head>
<body>
    <div class="debug" id="debug">
        Status: Loading...
        </div>
        
        <!-- Menu Screen -->
    <div id="menu-screen" class="screen">
            <div class="title">NEON RUNNER</div>
            <div class="subtitle">CYBERPUNK HIGHWAY</div>
            
            <!-- Banner en menú principal -->
            <div id="menu-banner" style="margin: 20px 0; padding: 10px; background: rgba(0,0,0,0.8); border: 1px solid #00FFFF; border-radius: 8px;">
                <ins class="adsbygoogle" 
                     style="display:block;width:320px;height:50px;" 
                     data-ad-client="ca-pub-4129506161314540" 
                     data-ad-slot="6673201053"></ins>
            </div>
            
        <button class="btn" onclick="startGame()">🏃 EMPEZAR JUEGO</button>
        <button class="btn" onclick="testVisuals()">🎨 TEST VISUAL</button>
        <button class="btn" onclick="testAudio()">🔊 TEST AUDIO</button>
        
        <div class="ui">
            <div class="ui-item">
                <div class="ui-label">MEJOR DISTANCIA</div>
                <div class="ui-value" id="best-distance">0m</div>
                    </div>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen hidden">
        
        <!-- TOP BANNER AD - MOBILE-FIRST -->
        <div id="top-banner" style="background: rgba(0,0,0,0.85); padding: 5px; text-align: center; position: fixed; top: 0; width: 100%; z-index: 1000; height: 60px; display: none; align-items: center; justify-content: center; border-bottom: 1px solid #333;">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-4129506161314540"
                 data-ad-slot="auto"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            </div>
            
        <!-- VERTICAL MOBILE HUD -->
        <div style="position: fixed; top: 70px; left: 0; width: 100%; z-index: 1000; display: flex; justify-content: space-around; padding: 10px; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);">
            <div style="text-align: center; color: #00FFFF; font-size: 0.9rem;">
                <div style="opacity: 0.8;">DISTANCIA</div>
                <div style="font-weight: 900; color: #FFFF00;" id="distance">0m</div>
            </div>
            <div style="text-align: center; color: #00FFFF; font-size: 0.9rem;">
                <div style="opacity: 0.8;">MONEDAS</div>
                <div style="font-weight: 900; color: #FFD700;" id="coins">0</div>
        </div>
            <div style="text-align: center; color: #00FFFF; font-size: 0.9rem;">
                <div style="opacity: 0.8;">VELOCIDAD</div>
                <div style="font-weight: 900; color: #FF0080;" id="speed">3.0</div>
                </div>
            </div>
            
        <div class="game-area" id="game-area">
                <div id="runner" class="runner"></div>
            </div>
            
            <!-- FLIGHT ENERGY BAR -->
            <div class="flight-energy-container" id="flightEnergyContainer">
                <div class="flight-energy-label">🚀 ENERGÍA DE VUELO</div>
                <div class="flight-energy-bar" id="flightEnergyBar"></div>
            </div>
            
            <!-- COMPACT MOBILE INSTRUCTIONS - NO OVERLAP -->
            <div style="position: fixed; bottom: 10px; left: 10px; right: 10px; z-index: 1000; background: rgba(0,0,0,0.9); padding: 8px; border-radius: 8px; border: 1px solid #00FFFF; font-size: 0.7rem; text-align: center; color: #00FFFF;">
                🚀 <strong>TAP = SALTAR</strong> • ⚡ <strong>DOBLE TAP = DOBLE SALTO</strong> • 🛡️ Verde=Escudo 🔵 Azul=Lento 🧲 Rosa=Imán
            </div>
            
        <button class="btn" onclick="showMenu()" style="position: fixed; top: 20px; right: 20px; z-index: 1001; padding: 10px 15px; font-size: 0.8rem;">🏠 MENÚ</button>
        
        <!-- BOTTOM BANNER AD - MOBILE-FIRST -->
        <div id="bottom-banner" style="background: rgba(0,0,0,0.85); padding: 5px; text-align: center; position: fixed; bottom: 0; width: 100%; z-index: 1000; height: 60px; display: none; align-items: center; justify-content: center; border-top: 1px solid #333;">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-4129506161314540"
                 data-ad-slot="auto"
                 data-ad-format="auto"
             data-full-width-responsive="true"></ins>
    </div>
    
        <!-- Banner lateral para móviles (más agresivo) -->
        <div id="side-banner" style="position:fixed; right:10px; top:50%; transform:translateY(-50%); width:120px; height:600px; background:rgba(0,0,0,0.8); border:1px solid #00FFFF; border-radius:8px; display:none; z-index:1000;">
        <ins class="adsbygoogle"
                 style="display:block;width:120px;height:600px;" 
             data-ad-client="ca-pub-4129506161314540"
                 data-ad-slot="6673201053"></ins>
        </div>
    </div>
    
    <script>
        // Game State
        let gameState = {
            distance: 0,
            coins: 0,
            speed: 3.0, // Start slower
            gameActive: false,
            obstacles: [],
            collectibles: [],
            doubleJumpAvailable: true,
            tripleJumpAvailable: true,
            invulnerable: false,
            shieldActive: false,
            slowMotionActive: false,
            // Sistemas adictivos
            streak: 0,
            perfectJumps: 0,
            comboMultiplier: 1,
            lastActionTime: 0,
            adrenalineMode: false
        };
        
        let currentScreen = 'menu';
        let gameLoop;
        let debugElement;
        
        function updateDebug(message) {
            if (!debugElement) debugElement = document.getElementById('debug');
            debugElement.textContent = `Status: ${message}`;
            console.log(`🎮 ${message}`);
        }
        
        function showScreen(screenName) {
            updateDebug(`Switching to ${screenName}`);
            
            const screens = ['menu', 'game'];
            screens.forEach(name => {
                const screen = document.getElementById(name + '-screen');
                if (screen) {
                    screen.classList.add('hidden');
                    screen.style.display = 'none';
                }
            });
            
            const targetScreen = document.getElementById(screenName + '-screen');
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                targetScreen.style.display = 'flex';
                currentScreen = screenName;
                updateDebug(`Now showing ${screenName} screen`);
            } else {
                updateDebug(`ERROR: Screen ${screenName} not found!`);
            }
        }
        
        function showMenu() {
            if (gameLoop) {
                cancelAnimationFrame(gameLoop);
                gameLoop = null;
            }
            gameState.gameActive = false;
            showScreen('menu');
        }
        
        function testVisuals() {
            updateDebug('Testing visuals...');
            
            // Test runner animation
            const runner = document.getElementById('runner');
            if (runner) {
                runner.classList.add('jumping');
                setTimeout(() => runner.classList.remove('jumping'), 600);
                updateDebug('Runner animation test OK');
            } else {
                updateDebug('ERROR: Runner element not found!');
            }
            
            // Test obstacle creation
            createTestObstacle();
            
            // Test coin creation
            createTestCoin();
        }
        
        function testAudio() {
            updateDebug('Testing audio...');
            
            if (!audioContext) {
                initAudio();
            }
            
            if (audioContext) {
                audioContext.resume().then(() => {
                    // Test jump sound
                    playSound(600, 150, 'square', 0.12);
                    updateDebug('Jump sound played');
                    
                    // Test coin sound
                    setTimeout(() => {
                        playSound(800, 100, 'square', 0.15);
                        setTimeout(() => playSound(1000, 80, 'square', 0.1), 50);
                        updateDebug('Coin sound played');
                    }, 300);
                    
                    // Test background music
                    setTimeout(() => {
                        playBackgroundMusic();
                        updateDebug('Background music started');
                        
                        // Stop after 3 seconds
                        setTimeout(() => {
                    stopBackgroundMusic();
                            updateDebug('Background music stopped');
                        }, 3000);
                    }, 600);
                });
            } else {
                updateDebug('Audio context not available');
            }
        }
        
        function createTestObstacle() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) {
                updateDebug('ERROR: Game area not found!');
                return;
            }
            
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            obstacle.style.right = '50px';
            gameArea.appendChild(obstacle);
            
            updateDebug('Test obstacle created');
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (obstacle.parentNode) {
                    obstacle.parentNode.removeChild(obstacle);
                    updateDebug('Test obstacle removed');
                }
            }, 3000);
        }
        
        function createTestCoin() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) return;
            
            const coin = document.createElement('div');
            coin.className = 'coin';
            coin.style.right = '150px';
            coin.style.bottom = '100px';
            gameArea.appendChild(coin);
            
            updateDebug('Test coin created');
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (coin.parentNode) {
                    coin.parentNode.removeChild(coin);
                    updateDebug('Test coin removed');
                }
            }, 3000);
        }
        
        function startGame() {
            updateDebug('Starting VERTICAL game...');
            
            // Track game start
            gtag('event', 'game_start', { game_name: 'neon_runner' });
            
            gameState.distance = 0;
            gameState.coins = 0;
            gameState.speed = 4.0; // Vertical speed
            gameState.gameActive = true;
            gameState.obstacles = [];
            
            // Reset banner strategy
            bannerShown = false;
            gameStartTime = Date.now();
            gameState.collectibles = [];
            // Reset runner position to center
            gameState.runnerX = 50;
            
            showScreen('game');
            clearGameArea();
            
            // Reset runner to start position
            const runner = document.getElementById('runner');
            if (runner) {
                runner.style.left = '80px';
            }
            
            // Initialize and start audio
            if (!audioContext) {
                initAudio();
            }
            
            if (audioContext) {
                audioContext.resume().then(() => {
                setTimeout(() => {
                        if (gameState.gameActive) {
                        playBackgroundMusic();
                    }
                }, 500);
                });
            }
            
            startGameLoop();
            
            updateDebug('VERTICAL game started successfully');
        }
        
        function clearGameArea() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) return;
            
            const obstacles = gameArea.querySelectorAll('.obstacle');
            const coins = gameArea.querySelectorAll('.coin');
            
            obstacles.forEach(el => el.remove());
            coins.forEach(el => el.remove());
            
            updateDebug('Game area cleared');
        }
        
        function startGameLoop() {
            updateDebug('Starting game loop...');
            
            let lastFrameTime = 0;
            const targetFPS = 60;
            const frameTime = 1000 / targetFPS;
            
            function gameLoopFrame(currentTime) {
                if (!gameState.gameActive) return;
                
                // Frame rate limiting for consistent performance
                if (currentTime - lastFrameTime >= frameTime) {
                updateGame();
                    lastFrameTime = currentTime;
                }
                
                // Use requestAnimationFrame for smooth 60fps
                gameLoop = requestAnimationFrame(gameLoopFrame);
            }
            
            gameLoopFrame(performance.now());
        }
        
        function updateGame() {
            if (!gameState.gameActive) return;
            
            // 🚀 VOLVER AL GAMEPLAY HORIZONTAL PERFECTO (pero en pantalla vertical)
            moveElements();
            
            // Ultra-smooth distance progression
            gameState.distance += gameState.speed * 0.1;
            
            // Verificar si mostrar banners después de 30s
            checkBannerDisplay();
            
            // 🚀 VELOCIDAD INFINITA - ¡HASTA LA VELOCIDAD DE LA LUZ!
            gameState.speed += 0.008; // Aceleración constante SIN LÍMITE
            
            // Feedback épico cuando alcanza velocidades altas
            if (gameState.speed > 15 && Math.floor(gameState.speed) % 5 === 0) {
                showPerfectIndicator(`🚀 VELOCIDAD: ${Math.floor(gameState.speed)}! 🌌`);
                playSound(800 + gameState.speed * 10, 100, 'sawtooth', 0.08);
            }
            
            // Reset streak if no action for too long (makes it more challenging)
            if (Date.now() - gameState.lastActionTime > 3000 && gameState.streak > 0) {
                gameState.streak = 0;
                updateDebug('Streak reset - no action');
            }
            
            // 🎮 SPAWN BALANCEADO Y JUGABLE
            const obstacleChance = gameState.adrenalineMode ? 0.008 : 0.006; // MUCHO MÁS SUAVE
            const coinChance = gameState.adrenalineMode ? 0.015 : 0.012; // Monedas normales
            
            // 🎮 OBSTACLE SPAWNING SIMPLE Y PREDECIBLE
            if (gameState.obstacles.length < 2 && Math.random() < obstacleChance) {
                const lastObstacle = gameState.obstacles[gameState.obstacles.length - 1];
                
                // 📏 ESPACIADO FIJO Y SEGURO - Siempre superable
                const spacing = 400 + Math.random() * 200; // Entre 400px y 600px - MUY SEGURO
                
                if (!lastObstacle || lastObstacle.x < spacing) {
                spawnObstacle();
                }
            }
            
            if (gameState.collectibles.length < 6 && Math.random() < coinChance) {
                spawnCoin();
            }
            
            if (gameState.collectibles.length < 8 && Math.random() < 0.008) { // MÁS POWER-UPS
                spawnPowerUp();
            }
            
            updateUI();
        }
        
        function spawnObstacle() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) return;
            
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            const startX = gameArea.offsetWidth;
            
            // Diferentes tipos de obstáculos para variedad
            const obstacleTypes = ['normal', 'tall', 'wide'];
            const type = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
            
            switch(type) {
                case 'tall':
                    obstacle.style.height = '80px';
                    obstacle.style.background = 'linear-gradient(45deg, #FF0080, #FF4500)';
                    break;
                case 'wide':
                    obstacle.style.width = '60px';
                    obstacle.style.background = 'linear-gradient(45deg, #00FFFF, #0080FF)';
                    break;
                default:
                    // Normal obstacle - default styles from CSS
                    break;
            }
            
            // Position at the right edge initially
            obstacle.style.right = '0px';
            obstacle.style.left = 'auto';
            
            gameArea.appendChild(obstacle);
            
            gameState.obstacles.push({
                element: obstacle,
                x: startX,
                type: type
            });
            
            updateDebug(`${type} obstacle spawned (total: ${gameState.obstacles.length})`);
        }
        
        function spawnCoin() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) return;
            
            const coin = document.createElement('div');
            coin.className = 'coin';
            const startX = gameArea.offsetWidth;
            
            coin.style.right = '0px';
            coin.style.left = 'auto';
            coin.style.bottom = (50 + Math.random() * 200) + 'px';
            
            gameArea.appendChild(coin);
            
            gameState.collectibles.push({
                element: coin,
                type: 'coin',
                x: startX
            });
            
            updateDebug(`Coin spawned (total: ${gameState.collectibles.length})`);
        }
        
        function spawnPowerUp() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) return;
            
            const powerUpTypes = ['shield', 'slow-motion', 'magnet'];
            const type = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
            const startX = gameArea.offsetWidth;
            
            const powerUp = document.createElement('div');
            powerUp.className = `power-up ${type}`;
            powerUp.style.right = '0px';
            powerUp.style.left = 'auto';
            powerUp.style.bottom = (80 + Math.random() * 150) + 'px';
            powerUp.dataset.type = type;
            
            gameArea.appendChild(powerUp);
            
            gameState.collectibles.push({
                element: powerUp,
                type: 'power-up',
                powerType: type,
                x: startX
            });
            
            updateDebug(`Power-up spawned: ${type}`);
        }
        
        function moveElements() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) return;
            
            try {
                // Cache expensive DOM operations once
                const canvasWidth = gameArea.offsetWidth;
                const runner = document.getElementById('runner');
                const speed = gameState.speed;
                
                // 🚀 OPTIMIZACIÓN DIRECTA PARA MÁXIMA FLUIDEZ
                
                // Process obstacles - HORIZONTAL MOVEMENT (obstacles move LEFT)
                let obstacleCollision = false;
            gameState.obstacles = gameState.obstacles.filter(obstacle => {
                    obstacle.x -= speed; // Move LEFT (horizontal gameplay)
                
                    if (obstacle.x < -100) {
                        try {
                    obstacle.element.remove();
                        } catch (e) {
                            // Silent cleanup
                        }
                    return false;
                }
                    
                    // 🚀 OPTIMIZACIÓN DE FLUIDEZ - Actualización directa más rápida
                    if (obstacle.element && obstacle.element.parentNode) {
                        obstacle.element.style.right = (canvasWidth - obstacle.x) + 'px';
                    }
                    
                    // Simplified collision detection
                    if (!obstacleCollision && !gameState.shieldActive && 
                        obstacle.x > 60 && obstacle.x < 180) {
                        if (checkSimpleCollision(runner, obstacle.element)) {
                            obstacleCollision = true;
                            gameOver();
                            return true;
                        }
                    }
                    
                return true;
            });
            
                // Process collectibles
                gameState.collectibles = gameState.collectibles.filter(coin => {
                    coin.x -= speed;
                    
                    if (coin.x < -100) {
                        try {
                            coin.element.remove();
                        } catch (e) {
                            // Silent cleanup
                        }
                    return false;
                }
                    
                    // 🚀 OPTIMIZACIÓN DE FLUIDEZ - Actualización directa
                    if (coin.element && coin.element.parentNode) {
                        coin.element.style.right = (canvasWidth - coin.x) + 'px';
                    }
                    
                    // Simplified collection detection
                    if (coin.x > 80 && coin.x < 160) {
                        if (checkSimpleCollision(runner, coin.element)) {
                            if (coin.type === 'coin') {
                                collectCoin(coin);
                                return false; // Remove collected coin
                            } else if (coin.type === 'power-up') {
                                collectPowerUp(coin);
                                return false; // Remove collected power-up
                            }
                        }
                    }
                    
                return true;
            });
            
                // 🚀 FLUIDEZ OPTIMIZADA - Sin batching, actualizaciones directas más rápidas
                
            } catch (e) {
                updateDebug('Move elements error: ' + e.message);
            }
        }
        
        // Ultra-simplified collision detection for performance
        function checkSimpleCollision(runner, element) {
            if (!runner || !element) return false;
            
            try {
                const runnerRect = runner.getBoundingClientRect();
                const elementRect = element.getBoundingClientRect();
                
                // Simple overlap check with generous margins
                return !(runnerRect.right < elementRect.left + 10 || 
                        runnerRect.left > elementRect.right - 10 || 
                        runnerRect.bottom < elementRect.top + 10 || 
                        runnerRect.top > elementRect.bottom - 10);
            } catch (e) {
                    return false;
                }
        }
        
        // Optimized collision detection using cached positions
        function checkCollisionOptimized(element1, element2) {
            const rect1 = element1.getBoundingClientRect();
            const rect2 = element2.getBoundingClientRect();
            
            // Simplified collision with margins for better gameplay feel
            const margin = 5;
            return !(rect1.right < rect2.left + margin || 
                    rect1.left > rect2.right - margin || 
                    rect1.bottom < rect2.top + margin || 
                    rect1.top > rect2.bottom - margin);
        }
        
        function updateUI() {
            document.getElementById('distance').textContent = Math.floor(gameState.distance) + 'm';
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('speed').textContent = gameState.speed.toFixed(1);
        }
        
        // Audio System - 8-bit Addictive
        let audioContext = null;
        let backgroundMusicInterval = null;
        
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                updateDebug('Audio initialized');
            } catch (e) {
                updateDebug('Audio not supported');
            }
        }
        
        function playSound(frequency = 440, duration = 150, type = 'square', volume = 0.1) {
            if (!audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type; // 8-bit style
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration/1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration/1000);
            } catch (e) {
                updateDebug('Audio error: ' + e.message);
            }
        }
        
        // 8-bit background music - Optimized for performance
        function playBackgroundMusic() {
            if (!audioContext || backgroundMusicInterval || !gameState.gameActive) return;
            
            const melody = [
                // Simplified melody for better performance
                {note: 659, duration: 400}, // E5
                {note: 523, duration: 400}, // C5
                {note: 784, duration: 400}, // G5
                {note: 392, duration: 400}, // G4
                {note: 523, duration: 400}, // C5
                {note: 659, duration: 400}, // E5
                {note: 440, duration: 400}, // A4
                {note: 494, duration: 400}, // B4
            ];
            
            let noteIndex = 0;
            
            function playNextNote() {
                try {
                    if (!audioContext || !gameState.gameActive || gameState.adrenalineMode) {
                        stopBackgroundMusic();
                        return;
                    }
                    
                    const currentNote = melody[noteIndex];
                    
                    if (currentNote.note > 0) {
                        playSound(currentNote.note, currentNote.duration * 0.6, 'square', 0.03);
                    }
                    
                    noteIndex = (noteIndex + 1) % melody.length;
                    backgroundMusicInterval = setTimeout(playNextNote, currentNote.duration);
                } catch (e) {
            stopBackgroundMusic();
                }
            }
            
            playNextNote();
            updateDebug('Optimized music started');
        }
        
        function stopBackgroundMusic() {
            if (backgroundMusicInterval) {
                clearTimeout(backgroundMusicInterval);
                backgroundMusicInterval = null;
                updateDebug('Music stopped');
            }
        }
        
        // Música ultra-rápida para modo adrenalina
        function playFastBackgroundMusic() {
            if (!audioContext || backgroundMusicInterval) return;
            
            const fastMelody = [
                // Misma melodía pero más rápida y aguda
                {note: 1319, duration: 150}, // E6 (doble frecuencia)
                {note: 1319, duration: 150}, // E6
                {note: 0, duration: 75},     // Rest
                {note: 1319, duration: 150}, // E6
                {note: 0, duration: 75},     // Rest
                {note: 1047, duration: 150}, // C6
                {note: 1319, duration: 150}, // E6
                {note: 0, duration: 75},     // Rest
                {note: 1568, duration: 200}, // G6
                {note: 0, duration: 200},    // Rest
                {note: 784, duration: 200},  // G5
                {note: 0, duration: 200},    // Rest
            ];
            
            let noteIndex = 0;
            
            function playFastNote() {
                if (!audioContext || !gameState.gameActive || !gameState.adrenalineMode) {
                    stopBackgroundMusic();
                    return;
                }
                
                const currentNote = fastMelody[noteIndex];
                
                if (currentNote.note > 0) {
                    playSound(currentNote.note, currentNote.duration * 0.8, 'square', 0.06);
                }
                
                noteIndex = (noteIndex + 1) % fastMelody.length;
                backgroundMusicInterval = setTimeout(playFastNote, currentNote.duration);
            }
            
            playFastNote();
            updateDebug('Fast adrenaline music started');
        }
        
        // Game functions
        function checkCollision(element1, element2) {
            const rect1 = element1.getBoundingClientRect();
            const rect2 = element2.getBoundingClientRect();
            
            return !(rect1.right < rect2.left || 
                    rect1.left > rect2.right || 
                    rect1.bottom < rect2.top || 
                    rect1.top > rect2.bottom);
        }
        
        function collectCoin(coin) {
            gameState.coins++;
            gameState.streak++;
            gameState.lastActionTime = Date.now();
            
            // Calcular multiplicador de combo
            let bonusCoins = 1;
            if (gameState.streak >= 5) bonusCoins = 2;
            if (gameState.streak >= 10) bonusCoins = 3;
            if (gameState.streak >= 20) bonusCoins = 5;
            
            gameState.coins += (bonusCoins - 1);
            
            // Efectos visuales optimizados (solo cada 3 coins para reducir lag)
            if (gameState.streak % 3 === 0) {
                createCoinBurstEffect(coin.element);
            }
            
            // Sonidos adictivos progresivos
            const basePitch = Math.min(800 + (gameState.streak * 15), 1200); // Cap máximo
            playSound(basePitch, 80, 'square', 0.12); // Más corto
            
            if (bonusCoins > 1) {
                setTimeout(() => playSound(basePitch + 200, 60, 'square', 0.08), 40);
                
                // Indicadores solo para combos importantes
                if (gameState.streak >= 10) {
                    showPerfectIndicator(`+${bonusCoins} COINS!`);
                }
            }
            
            // Streak visual solo para milestones importantes
            if (gameState.streak >= 5 && gameState.streak % 5 === 0) {
                showStreakCounter(gameState.streak);
            }
            
            if (gameState.streak % 15 === 0) {
                showComboExplosion(`${gameState.streak}x MEGA!`);
                addScreenShake();
            }
            
            try {
            coin.element.remove();
            } catch (e) {
                // Silent cleanup
            }
            
            updateDebug(`Coin! Streak: ${gameState.streak}, Bonus: +${bonusCoins}`);
        }
        
        function collectPowerUp(powerUp) {
            powerUp.element.remove();
            
            // Power-up collection sound
            playSound(1200, 150, 'square', 0.18);
            setTimeout(() => playSound(1400, 100, 'square', 0.15), 75);
            setTimeout(() => playSound(1600, 100, 'square', 0.12), 150);
            
            const runner = document.getElementById('runner');
            
            switch(powerUp.powerType) {
                case 'shield':
                    activateShield(runner);
                    break;
                case 'slow-motion':
                    activateSlowMotion();
                    break;
                case 'magnet':
                    activateMagnet();
                    break;
            }
            
            updateDebug(`Power-up collected: ${powerUp.powerType}`);
        }
        
        function activateShield(runner) {
            gameState.shieldActive = true;
            runner.classList.add('shielded');
            
            updateDebug('Shield activated! Invulnerable for 5 seconds');
            
                setTimeout(() => {
                gameState.shieldActive = false;
                runner.classList.remove('shielded');
                updateDebug('Shield deactivated');
            }, 5000); // 5 seconds of protection
        }
        
        function activateSlowMotion() {
            gameState.slowMotionActive = true;
            const gameArea = document.getElementById('game-area');
            gameArea.classList.add('slow-motion-effect');
            
            const originalSpeed = gameState.speed;
            gameState.speed = originalSpeed * 0.4; // 60% slower
            
            updateDebug('Slow motion activated! 60% slower for 4 seconds');
            
            setTimeout(() => {
                gameState.slowMotionActive = false;
                gameArea.classList.remove('slow-motion-effect');
                gameState.speed = originalSpeed;
                updateDebug('Slow motion deactivated');
            }, 4000); // 4 seconds of slow motion
        }
        
        function activateMagnet() {
            updateDebug('Coin magnet activated! Auto-collect for 6 seconds');
            
            const magnetInterval = setInterval(() => {
                if (!gameState.gameActive) {
                    clearInterval(magnetInterval);
                    return;
                }
                
                // Auto-collect nearby coins
                gameState.collectibles.forEach((item, index) => {
                    if (item.type === 'coin') {
                        const distance = Math.abs(item.x - 150); // Runner position
                        if (distance < 200) { // Within magnet range
                            collectCoin(item);
                            gameState.collectibles.splice(index, 1);
                        }
                    }
                });
            }, 100);
            
            setTimeout(() => {
                clearInterval(magnetInterval);
                updateDebug('Coin magnet deactivated');
            }, 6000); // 6 seconds of auto-collection
        }
        
        function restoreFlightEnergy() {
            const oldEnergy = gameState.flightEnergy;
            gameState.flightEnergy = Math.min(gameState.flightEnergy + 50, gameState.maxFlightEnergy);
            const restored = gameState.flightEnergy - oldEnergy;
            
            // Epic energy restoration effect
            showPerfectIndicator(`⚡ +${Math.floor(restored)}% ENERGÍA! ⚡`);
            
            // Energy restoration sound
            playSound(800, 200, 'triangle', 0.15);
            setTimeout(() => playSound(1000, 150, 'triangle', 0.12), 100);
            setTimeout(() => playSound(1200, 100, 'triangle', 0.1), 200);
            
            updateDebug(`Flight energy restored: +${Math.floor(restored)}%`);
        }
        
        function gameOver() {
            gameState.gameActive = false;
            stopBackgroundMusic();
            
            // Track game over
            gtag('event', 'game_over', { 
                game_name: 'neon_runner', 
                score: Math.floor(gameState.distance),
                coins: gameState.coins,
                speed: Math.floor(gameState.speed)
            });
            
            // Show interstitial ad
            showInterstitialAd();
            
            // 8-bit game over sound
            playSound(330, 200, 'sawtooth', 0.2);
            setTimeout(() => playSound(247, 200, 'sawtooth', 0.2), 200);
            setTimeout(() => playSound(196, 400, 'sawtooth', 0.2), 400);
            
            updateDebug('GAME OVER!');
            
            setTimeout(() => {
                showGameOverScreen();
            }, 1000);
        }
        
        // 🚀 VIRAL SHARING SYSTEM
        function showGameOverScreen() {
            const distance = Math.floor(gameState.distance);
            const coins = gameState.coins;
            const speed = Math.floor(gameState.speed);
            
            // Create viral message
            const shareText = `🚀 ¡Acabo de conseguir ${distance}m en Neon Runner! 
⚡ Velocidad máxima: ${speed}
💰 Monedas: ${coins}
🎮 ¿Puedes superarme?`;
            
            const gameUrl = 'https://neon-runner-lipastudios.netlify.app';
            const hashtags = 'NeonRunner,Gaming,Addictive,Challenge';
            
            // Show share modal
            const modal = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; align-items: center; justify-content: center;" id="shareModal">
                    <div style="background: linear-gradient(145deg, #1a1a2e, #16213e); padding: 20px; border-radius: 15px; text-align: center; max-width: 350px; border: 2px solid #00FFFF; box-shadow: 0 0 30px rgba(0,255,255,0.5);">
                        <h2 style="color: #FF0080; margin-bottom: 15px;">🎮 GAME OVER! 🎮</h2>
                        <div style="color: #00FFFF; margin-bottom: 20px; font-size: 1.1rem;">
                            🚀 Distancia: <strong>${distance}m</strong><br>
                            ⚡ Velocidad: <strong>${speed}</strong><br>
                            💰 Monedas: <strong>${coins}</strong>
                        </div>
                        
                        <div style="margin-bottom: 20px; color: #FFD700; font-weight: bold; font-size: 1.2rem;">
                            💰 CONTINUE RUNNING? 💰
                        </div>
                        <button onclick="watchAdToContinueRunner()" style="background: linear-gradient(45deg, #FFD700, #FFA500); color: #000; border: none; padding: 18px 30px; margin: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1.1rem; box-shadow: 0 4px 15px rgba(255,215,0,0.4); animation: pulse 2s infinite;">🎬 WATCH AD TO CONTINUE</button>
                        
                        <div style="margin-bottom: 20px; color: #FFFF00; font-weight: bold; font-size: 1rem;">
                            OR SHARE YOUR SCORE! 🔥
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 15px; justify-content: center; margin-bottom: 20px;">
                            <button onclick="shareNative()" style="background: linear-gradient(45deg, #FF0080, #00FFFF); color: white; border: none; padding: 15px 25px; border-radius: 12px; cursor: pointer; font-size: 1.1rem; font-weight: bold; box-shadow: 0 0 20px rgba(255,0,128,0.5);">📱 COMPARTIR (Elige tu app)</button>
                            <button onclick="copyViralMessage()" style="background: linear-gradient(45deg, #00FFFF, #FFFF00); color: #000; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: bold;">📋 COPIAR MENSAJE VIRAL</button>
                            <button onclick="generateShareImage()" style="background: linear-gradient(45deg, #FF0080, #FF8C00); color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: bold;">📸 GENERAR IMAGEN</button>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button onclick="restartGame()" style="background: #FF0080; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold;">🔄 JUGAR DE NUEVO</button>
                            <button onclick="closeShareModal(); showMenu();" style="background: #333; color: white; border: 2px solid #00FFFF; padding: 10px 20px; border-radius: 8px; cursor: pointer;">🏠 MENÚ</button>
                        </div>
                        
                        <!-- Interstitial Ad Container -->
                        <div id="gameOverAd" style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.8); border: 1px solid #00FFFF; border-radius: 8px;">
                            <ins class="adsbygoogle"
                                 style="display:block"
                                 data-ad-client="ca-pub-4129506161314540"
                                 data-ad-slot="6673201053"
                                 data-ad-format="auto"></ins>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            // Mostrar banners en game over
            try {
                const top = document.getElementById('top-banner');
                const bottom = document.getElementById('bottom-banner');
                if (top) top.style.display = 'flex';
                if (bottom) bottom.style.display = 'flex';
            } catch (e) {}
            
            // Track game over event
            window.trackEvent('game_over_with_score', {
                distance: distance,
                coins: coins,
                speed: speed,
                share_modal_shown: true
            });
        }
        
        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            if (modal) modal.remove();
            // Ocultar banners cuando se cierra modal (si vuelve a jugar o al menú)
            const top = document.getElementById('top-banner');
            const bottom = document.getElementById('bottom-banner');
            if (top) top.style.display = 'none';
            if (bottom) bottom.style.display = 'none';
        }
        
        // 🚀 NUEVA SHARING FUNCTIONS - ULTRA EFECTIVAS
        function shareNative() {
            const distance = Math.floor(gameState.distance);
            const coins = gameState.coins;
            const speed = Math.floor(gameState.speed);
            
            const shareData = {
                title: '🚀 Neon Runner - ¡Mira mi score épico!',
                text: `🚀 ¡Acabo de conseguir ${distance}m en Neon Runner! ⚡ Velocidad máxima: ${speed} 💰 Monedas: ${coins} 🎮 ¿Puedes superarme?`,
                url: 'https://neon-runner-lipastudios.netlify.app'
            };
            
            if (navigator.share) {
                // WEB SHARE API NATIVO - FUNCIONA CON TODAS LAS APPS
                navigator.share(shareData).then(() => {
                    window.trackEvent('native_share_success', { 
                        score: distance, 
                        method: 'web_share_api' 
                    });
                    alert('🎉 ¡Compartido exitosamente! Gracias por ayudar a que el juego se vuelva viral 🔥');
                }).catch((error) => {
                    console.log('Share cancelled', error);
                    copyViralMessage(); // Fallback
                });
                } else {
                // FALLBACK: Copy to clipboard
                copyViralMessage();
            }
        }
        
        function copyViralMessage() {
            const distance = Math.floor(gameState.distance);
            const coins = gameState.coins;
            const speed = Math.floor(gameState.speed);
            
            const viralMessage = `🚀 ¡NUEVO RÉCORD EN NEON RUNNER! 🚀

🎯 Mi score: ${distance} metros
⚡ Velocidad alcanzada: ${speed}
💰 Monedas conseguidas: ${coins}

🎮 ¿PUEDES SUPERARME?
Juega GRATIS aquí 👇
https://neon-runner-lipastudios.netlify.app

#NeonRunner #Gaming #Challenge #Adictivo`;

            navigator.clipboard.writeText(viralMessage).then(() => {
                alert('📋 ¡MENSAJE VIRAL COPIADO! 🔥\n\nAhora pégalo en WhatsApp, Instagram, TikTok o donde quieras.\n\n¡Vamos a hacer este juego VIRAL! 🚀');
                window.trackEvent('viral_message_copied', { 
                    score: distance,
                    method: 'clipboard_copy'
                });
            }).catch(() => {
                // Show the message in a prompt as fallback
                prompt('📋 Copia este mensaje viral:', viralMessage);
            });
        }
        
        function generateShareImage() {
            // Create a canvas with the game score
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400;
            canvas.height = 600;
            
            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, 600);
            gradient.addColorStop(0, '#1a1a2e');
            gradient.addColorStop(1, '#16213e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 400, 600);
            
            // Add neon border
            ctx.strokeStyle = '#00FFFF';
            ctx.lineWidth = 4;
            ctx.strokeRect(10, 10, 380, 580);
            
            // Title
            ctx.fillStyle = '#FF0080';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('🚀 NEON RUNNER', 200, 80);
            
            // Score
            ctx.fillStyle = '#00FFFF';
            ctx.font = 'bold 48px Arial';
            ctx.fillText(`${Math.floor(gameState.distance)}m`, 200, 180);
            
            ctx.fillStyle = '#FFFF00';
            ctx.font = 'bold 24px Arial';
            ctx.fillText(`Velocidad: ${Math.floor(gameState.speed)}`, 200, 240);
            ctx.fillText(`Monedas: ${gameState.coins}`, 200, 280);
            
            // Challenge text
            ctx.fillStyle = '#FF0080';
            ctx.font = 'bold 28px Arial';
            ctx.fillText('¿PUEDES SUPERARME?', 200, 380);
            
            // URL
            ctx.fillStyle = '#00FFFF';
            ctx.font = '18px Arial';
            ctx.fillText('neon-runner-lipastudios.netlify.app', 200, 450);
            
            // Convert to image and trigger download
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `neon-runner-score-${Math.floor(gameState.distance)}m.png`;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('📸 ¡Imagen generada! Se ha descargado a tu móvil. ¡Compártela en Instagram Stories! 🔥');
                window.trackEvent('share_image_generated', { 
                    score: Math.floor(gameState.distance),
                    method: 'canvas_download'
                });
            });
        }
        
        // FUNCIONES DE EFECTOS ÉPICOS OPTIMIZADAS
        function createCoinBurstEffect(coinElement) {
            try {
                const rect = coinElement.getBoundingClientRect();
                const gameArea = document.getElementById('game-area');
                if (!gameArea) return;
                
                // Menos partículas para mejor performance
                for (let i = 0; i < 6; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle coin-burst';
                    
                    const angle = (i / 6) * Math.PI * 2;
                    const dx = Math.cos(angle) * 40 + 'px';
                    const dy = Math.sin(angle) * 40 + 'px';
                    
                    particle.style.left = (rect.left - gameArea.getBoundingClientRect().left) + 'px';
                    particle.style.top = (rect.top - gameArea.getBoundingClientRect().top) + 'px';
                    particle.style.setProperty('--dx', dx);
                    particle.style.setProperty('--dy', dy);
                    
                    gameArea.appendChild(particle);
                    
                    // Cleanup más rápido
                setTimeout(() => {
                        try {
                            if (particle.parentNode) particle.parentNode.removeChild(particle);
                        } catch (e) {
                            // Silently ignore cleanup errors
                        }
                    }, 600);
                }
            } catch (e) {
                updateDebug('Particle effect error: ' + e.message);
            }
        }
        
        function showPerfectIndicator(text) {
            // Limpiar indicadores existentes primero
            const existing = document.querySelectorAll('.perfect-indicator');
            existing.forEach(el => el.remove());
            
            const indicator = document.createElement('div');
            indicator.className = 'perfect-indicator';
            indicator.textContent = text;
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                try {
                    if (indicator.parentNode) indicator.parentNode.removeChild(indicator);
                } catch (e) {
                    // Silently ignore cleanup errors
                }
            }, 1000);
        }
        
        function showStreakCounter(streak) {
            // Limpiar streaks existentes
            const existing = document.querySelectorAll('.streak-counter');
            existing.forEach(el => el.remove());
            
            const counter = document.createElement('div');
            counter.className = 'streak-counter';
            counter.textContent = `${streak}x STREAK!`;
            document.body.appendChild(counter);
            
            setTimeout(() => {
                try {
                    if (counter.parentNode) counter.parentNode.removeChild(counter);
                } catch (e) {
                    // Silently ignore cleanup errors
                }
            }, 1500); // Más rápido para evitar acumulación
        }
        
        function showComboExplosion(text) {
            // Limpiar explosiones existentes
            const existing = document.querySelectorAll('.combo-explosion');
            existing.forEach(el => el.remove());
            
            const explosion = document.createElement('div');
            explosion.className = 'combo-explosion';
            explosion.textContent = text;
            document.body.appendChild(explosion);
            
            setTimeout(() => {
                try {
                    if (explosion.parentNode) explosion.parentNode.removeChild(explosion);
                } catch (e) {
                    // Silently ignore cleanup errors
                }
            }, 1000); // Más rápido
        }
        
        function addScreenShake() {
            const gameArea = document.getElementById('game-area');
            gameArea.classList.add('screen-shake');
            setTimeout(() => gameArea.classList.remove('screen-shake'), 300);
        }
        
        function activateAdrenalineMode() {
            // Evitar múltiples activaciones
            if (gameState.adrenalineMode) return;
            
            gameState.adrenalineMode = true;
            const runner = document.getElementById('runner');
            if (runner) runner.classList.add('speed-boost');
            
            // Música más rápida - sin delays para evitar conflicts
            try {
                stopBackgroundMusic();
                if (gameState.gameActive) {
                    playFastBackgroundMusic();
                }
            } catch (e) {
                updateDebug('Audio transition error: ' + e.message);
            }
            
            updateDebug('¡MODO ADRENALINA ACTIVADO!');
            
            setTimeout(() => {
                gameState.adrenalineMode = false;
                if (runner) runner.classList.remove('speed-boost');
                
                try {
                    stopBackgroundMusic();
                    if (gameState.gameActive) {
                        playBackgroundMusic();
                    }
                } catch (e) {
                    updateDebug('Audio restoration error: ' + e.message);
                }
                
                updateDebug('Modo adrenalina desactivado');
            }, 6000); // Más corto para evitar conflictos
        }
        
        // VERTICAL MOBILE CONTROLS - Nueva función para mover izquierda/derecha
        function moveHorizontal(direction) {
            if (currentScreen !== 'game') return;
            
            const runner = document.getElementById('runner');
            if (!runner) return;
            
            const currentLeft = parseFloat(runner.style.left) || 50; // Default center
            const moveDistance = 15; // Pixels to move
            const minLeft = 10; // Minimum boundary (%)
            const maxLeft = 90; // Maximum boundary (%)
            
            let newLeft = currentLeft;
            
            if (direction === 'left') {
                newLeft = Math.max(minLeft, currentLeft - moveDistance);
                playSound(400, 100, 'triangle', 0.1); // Left move sound
            } else if (direction === 'right') {
                newLeft = Math.min(maxLeft, currentLeft + moveDistance);
                playSound(600, 100, 'triangle', 0.1); // Right move sound
            }
            
            runner.style.left = newLeft + '%';
            
            // Visual feedback
            runner.style.transform = `translateX(-50%) scale(1.1)`;
            setTimeout(() => {
                runner.style.transform = `translateX(-50%) scale(1)`;
            }, 100);
            
            gameState.lastActionTime = Date.now();
            updateDebug(`Moved ${direction} to ${newLeft.toFixed(1)}%`);
        }

        // 🚀 NUEVA FUNCIÓN: DOBLE TAP JUMP - Salta desde cualquier altura
        function doubleTapJump() {
            if (currentScreen !== 'game') return;
            
            const runner = document.getElementById('runner');
            if (!runner) return;
            
            gameState.lastActionTime = Date.now();
            gameState.perfectJumps++;
            
            // DOBLE SALTO INMEDIATO desde cualquier posición
            runner.classList.remove('jumping', 'double-jump');
            runner.classList.add('double-jump');
            
            setTimeout(() => {
                runner.classList.remove('double-jump');
            }, 800);
            
            // 🔥 FEEDBACK ÉPICO PARA DOBLE TAP
            const pitch = 800 + (gameState.perfectJumps * 10);
            playSound(pitch, 120, 'square', 0.15);
            setTimeout(() => playSound(pitch + 300, 80, 'square', 0.12), 60);
            
            // 💫 FEEDBACK VISUAL PARA DOBLE TAP
            showPerfectIndicator('⚡⚡ DOBLE TAP! ⚡⚡');
            
            if (gameState.perfectJumps % 5 === 0) {
                showPerfectIndicator('🔥 PERFECT COMBO! 🔥');
                activateAdrenalineMode();
            }
            
            updateDebug('⚡⚡ DOBLE TAP JUMP ACTIVADO!');
        }

        function jump() {
            if (currentScreen !== 'game') return;
            
            const runner = document.getElementById('runner');
            if (!runner) return;
            
            gameState.lastActionTime = Date.now();
            
            // Normal jump
            if (runner.classList.contains('jumping') || runner.classList.contains('double-jump')) return;
            
            runner.classList.add('jumping');
        setTimeout(() => {
                runner.classList.remove('jumping');
                gameState.doubleJumpAvailable = true;
            }, 600);
            
            // Dynamic jump sound based on streak
            const jumpPitch = 600 + (gameState.streak * 5);
            playSound(jumpPitch, 150, 'square', 0.12);
            
            updateDebug('Jump!');
        }
        
        
        // ULTRA-SIMPLE MOBILE CONTROLS
        function handleTap() {
            if (currentScreen !== 'game') return;
            
            // SIMPLE: Every tap is just a jump (handles double jump automatically)
            jump();
        }
        
        // ========== VERTICAL GAMEPLAY FUNCTIONS ==========
        function createVerticalObstacle() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) return;
            
            // Create obstacle at random horizontal position, top of screen
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            
            // Random horizontal position (lanes)
            const lanes = [25, 40, 50, 60, 75]; // 5 lanes at different %
            const randomLane = lanes[Math.floor(Math.random() * lanes.length)];
            
            obstacle.style.left = randomLane + '%';
            obstacle.style.top = '-50px';
            obstacle.style.transform = 'translateX(-50%)';
            
            gameArea.appendChild(obstacle);
            
            gameState.obstacles.push({
                element: obstacle,
                y: -50, // Start above screen
                lane: randomLane // Store lane position for collision
            });
            
            updateDebug(`🔴 OBSTÁCULO VERTICAL creado en carril ${randomLane}%`);
        }
        
        function createVerticalCoin() {
            const gameArea = document.getElementById('game-area');
            if (!gameArea) return;
            
            const coin = document.createElement('div');
            coin.className = 'coin';
            
            // Random position, but not same as obstacles
            const coinLanes = [30, 45, 55, 70]; // Between obstacle lanes
            const randomLane = coinLanes[Math.floor(Math.random() * coinLanes.length)];
            
            coin.style.left = randomLane + '%';
            coin.style.top = '-50px';
            coin.style.transform = 'translateX(-50%)';
            
            gameArea.appendChild(coin);
            
            gameState.collectibles.push({
                element: coin,
                type: 'coin',
                y: -50,
                lane: randomLane
            });
            
            updateDebug(`💰 MONEDA VERTICAL creada en carril ${randomLane}%`);
        }
        
        function updateVerticalGame() {
            if (!gameState.gameActive) return;
            
            // Move obstacles down
            gameState.obstacles = gameState.obstacles.filter(obstacle => {
                obstacle.y += gameState.speed;
                
                // Remove if off screen
                if (obstacle.y > window.innerHeight + 100) {
                    try {
                        obstacle.element.remove();
                    } catch (e) {}
                    return false;
                }
                
                // Update position
                if (obstacle.element && obstacle.element.parentNode) {
                    obstacle.element.style.top = obstacle.y + 'px';
                }
                
                // Check collision with runner
                if (!gameState.shieldActive && checkVerticalCollision(obstacle)) {
                    gameOver();
                    return false;
                }
                
                return true;
            });
            
            // Move collectibles down
            gameState.collectibles = gameState.collectibles.filter(item => {
                item.y += gameState.speed;
                
                // Remove if off screen
                if (item.y > window.innerHeight + 100) {
                    try {
                        item.element.remove();
                    } catch (e) {}
                    return false;
                }
                
                // Update position
                if (item.element && item.element.parentNode) {
                    item.element.style.top = item.y + 'px';
                }
                
                // Check collection
                if (checkVerticalCollection(item)) {
                    collectCoin(item);
                    try {
                        item.element.remove();
                    } catch (e) {}
                    return false;
                }
                
                return true;
            });
            
            // Spawn new elements - MAYOR FRECUENCIA para que sea adictivo
            if (Math.random() < 0.08) { // 8% chance per frame - MÁS OBSTÁCULOS
                createVerticalObstacle();
            }
            
            if (Math.random() < 0.06) { // 6% chance per frame - MÁS MONEDAS
                createVerticalCoin();
            }
            
            // Update distance and speed
            gameState.distance += gameState.speed * 0.1;
            gameState.speed += 0.005; // Gradual acceleration
            
            // Update UI
            updateUI();
        }
        
        function checkVerticalCollision(obstacle) {
            const runner = document.getElementById('runner');
            if (!runner) return false;
            
            const runnerLane = parseFloat(runner.style.left) || 50;
            const runnerBottom = 100; // Runner fixed position from bottom
            
            // Check if obstacle is in runner's vertical zone
            if (obstacle.y > (window.innerHeight - runnerBottom - 80) && 
                obstacle.y < (window.innerHeight - runnerBottom + 20)) {
                // Check horizontal overlap
                const laneDiff = Math.abs(runnerLane - obstacle.lane);
                return laneDiff < 8; // Collision threshold
            }
            
            return false;
        }
        
        function checkVerticalCollection(item) {
            const runner = document.getElementById('runner');
            if (!runner) return false;
            
            const runnerLane = parseFloat(runner.style.left) || 50;
            const runnerBottom = 100;
            
            // Check if item is in runner's collection zone
            if (item.y > (window.innerHeight - runnerBottom - 60) && 
                item.y < (window.innerHeight - runnerBottom + 40)) {
                const laneDiff = Math.abs(runnerLane - item.lane);
                return laneDiff < 12; // Collection threshold
            }
            
            return false;
        }

        // 🚀 CONTROLES SIMPLES SIN DELAY - TAP = SALTAR, DOBLE TAP = DOBLE SALTO
        let lastTapTime = 0;
        
        document.addEventListener('touchstart', function(e) {
                e.preventDefault();
            if (currentScreen !== 'game') return;
            
            const currentTime = Date.now();
            const timeDiff = currentTime - lastTapTime;
            
            if (timeDiff < 250) { // 250ms window for double tap
                // DOBLE TAP = DOBLE SALTO INMEDIATO
                doubleTapJump();
            } else {
                // TAP INMEDIATO = SALTO INMEDIATO (sin delay)
                jump();
            }
            
            lastTapTime = currentTime;
        });
        
        // Mouse controls (for desktop testing) - SIMPLE Y SIN DELAY
        let lastClickTime = 0;
        
        document.addEventListener('click', function(e) {
            // Don't interfere with control buttons
            if (e.target.id === 'leftControl' || e.target.id === 'rightControl') return;
            if (currentScreen !== 'game') return;
            
            const currentTime = Date.now();
            const timeDiff = currentTime - lastClickTime;
            
            if (timeDiff < 250) { // Double click
                doubleTapJump();
            } else {
                jump(); // Single click - INMEDIATO
            }
            
            lastClickTime = currentTime;
        });
        
        // Keyboard controls (for desktop testing) - VOLVER A SIMPLE SPACE = SALTAR
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space') {
                e.preventDefault();
                jump();
            } else if (e.code === 'Escape') {
                e.preventDefault();
            showMenu();
            }
        });
        
        // REWARDED AD SYSTEM
        function showRewardedAd(callback) {
            adBreak({
                type: 'reward',
                name: 'extra-coins',
                beforeAd: () => {
                    console.log('Rewarded ad starting...');
                    // Pause game if running
                    if (gameState.gameActive) {
                        gameState.gameActive = false;
                    }
                },
                afterAd: () => {
                    console.log('Rewarded ad finished');
                    // Grant reward
                    gameState.coins += 50;
                    showPerfectIndicator('💰 +50 MONEDAS BONUS! 💰');
                    playSound(1000, 200, 'triangle', 0.2);
                    if (callback) callback();
                }
            });
        }
        
        // Add missing functions
        function showInterstitialAd() {
            try {
                gtag('event', 'ad_impression', { game_name: 'neon_runner' });
            } catch (e) {
                console.log('AdSense not loaded yet');
            }
        }
        
        function restartGame() {
            gtag('event', 'game_restart', { game_name: 'neon_runner' });
            closeShareModal();
            startGame();
        }

        // Ads helpers - ESTRATEGIA AGRESIVA PERO INTELIGENTE
        function showAds() {
            const top = document.getElementById('top-banner');
            const bottom = document.getElementById('bottom-banner');
            const side = document.getElementById('side-banner');
            const menu = document.getElementById('menu-banner');
            if (top) top.style.display = 'flex';
            if (bottom) bottom.style.display = 'flex';
            if (side) side.style.display = 'block';
            if (menu) menu.style.display = 'block';
            try {
            } catch(e) {}
        }
        
        function hideAds() {
            const top = document.getElementById('top-banner');
            const bottom = document.getElementById('bottom-banner');
            const side = document.getElementById('side-banner');
            const menu = document.getElementById('menu-banner');
            if (top) top.style.display = 'none';
            if (bottom) bottom.style.display = 'none';
            if (side) side.style.display = 'none';
            if (menu) menu.style.display = 'none';
        }
        
        // NUEVA ESTRATEGIA: Mostrar banners después de 30 segundos de juego
        let gameStartTime = 0;
        let bannerShown = false;
        
        function checkBannerDisplay() {
            if (!gameState.playing || bannerShown) return;
            
            const gameTime = Date.now() - gameStartTime;
            if (gameTime > 30000) { // 30 segundos
                showAds();
                bannerShown = true;
                console.log('💰 Banners mostrados después de 30s de juego');
            }
        }
        
        // Mostrar banners en pausa (oportunidad de monetización)
        function showPauseAds() {
            if (gameState.paused) {
                showAds();
                console.log('💰 Banners mostrados durante pausa');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDebug('DOM loaded');
            showMenu();
            
            // Track page view
            gtag('event', 'page_view', { game_name: 'neon_runner' });
            
            // 💰 ADSENSE READY
        });
        
        // Fallback initialization
        setTimeout(() => {
            if (currentScreen !== 'menu') {
                updateDebug('Fallback initialization');
                showMenu();
            }
        }, 1000);
        
        updateDebug('Script loaded');
        
        // ========== REWARDED ADS SYSTEM FOR NEON RUNNER ==========
        function watchAdToContinueRunner() {
            // Track rewarded ad attempt
            window.trackEvent('rewarded_ad_requested', {
                distance: Math.floor(gameState.distance),
                coins: gameState.coins,
                speed: Math.floor(gameState.speed),
                game: 'neon_runner'
            });
            
            // Show loading state
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '⏳ LOADING AD...';
            button.disabled = true;
            
            // H5 Games Ads API - Rewarded Video
            if (window.adBreak) {
                window.adBreak({
                    type: 'reward',
                    name: 'continue-running',
                    beforeAd: () => {
                        console.log('🎬 Rewarded ad starting...');
                        stopBackgroundMusic();
                    },
                    afterAd: () => {
                        console.log('✅ Rewarded ad completed!');
                        continueRunnerWithReward();
                    },
                    adDismissed: () => {
                        console.log('❌ Rewarded ad dismissed');
                        button.innerHTML = originalText;
                        button.disabled = false;
                        alert('⚠️ You need to watch the complete ad to continue running!');
                    },
                    adViewed: () => {
                        console.log('👁️ Rewarded ad viewed');
                        window.trackEvent('rewarded_ad_completed', {
                            distance: Math.floor(gameState.distance),
                            reward_type: 'continue_running',
                            game: 'neon_runner'
                        });
                    }
                });
            } else {
                // Fallback - Simulate ad for testing
                simulateRewardedAdRunner(button, originalText);
            }
        }
        
        function simulateRewardedAdRunner(button, originalText) {
            console.log('🧪 Simulating rewarded ad for Neon Runner');
            
            let countdown = 3;
            const interval = setInterval(() => {
                button.innerHTML = `🎬 AD PLAYING... ${countdown}s`;
                countdown--;
                
                if (countdown < 0) {
                    clearInterval(interval);
                    button.innerHTML = '✅ AD COMPLETE!';
                    
                    setTimeout(() => {
                        continueRunnerWithReward();
                    }, 1000);
                }
            }, 1000);
        }
        
        function continueRunnerWithReward() {
            // Grant reward: Continue running with bonus
            const bonusCoins = Math.floor(gameState.coins * 0.2); // 20% bonus coins
            gameState.coins += bonusCoins;
            gameState.speed = Math.max(4.0, gameState.speed - 1.0); // Reduce speed slightly
            
            // Reset some obstacles
            try {
                if (gameState && gameState.runner && typeof gameState.runner.x === 'number') {
                    gameState.obstacles = gameState.obstacles.filter(obstacle => obstacle.x > gameState.runner.x + 300);
                } else {
                    gameState.obstacles = [];
                }
            } catch (e) {
                console.log('Error filtering obstacles:', e);
                gameState.obstacles = [];
            }
            
            // Restart game
            gameState.gameActive = true;
            
            // Close modal
            closeShareModal();
            
            // Show reward notification
            updateDebug(`🎬 AD REWARD: +${bonusCoins} COINS! 🚀`);
            setTimeout(() => updateDebug(''), 3000);
            
            // Resume game
            if (!gameLoop) gameLoop = requestAnimationFrame(gameLoopFrame);
            playBackgroundMusic();
            
            // Track successful continue
            window.trackEvent('game_continued_with_ad', {
                distance: Math.floor(gameState.distance),
                bonus_coins: bonusCoins,
                game: 'neon_runner'
            });
            
            console.log('🎮 Neon Runner continued with reward!');
        }
    </script>
</body>
</html>
